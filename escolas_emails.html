<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEFOP - Extrator de E-mails em Massa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
    </style>
</head>
<body class="min-h-screen flex items-start justify-center p-4 sm:p-8">

    <script src="escolas_data.js"></script>

    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 sm:p-8 mt-10">

        <h1 class="text-3xl font-bold text-gray-800 mb-2">游닎 Extrator de E-mails em Massa</h1>
        <p class="text-gray-500 mb-6">Cole os nomes completos das escolas (um por linha) para extrair os e-mails.</p>

        <div class="space-y-4 mb-8">
            <label for="school-names-input" class="block text-sm font-medium text-gray-700">Lista de Nomes de Escolas:</label>
            
            <textarea id="school-names-input" rows="8" placeholder="Cole os nomes das escolas aqui. Exemplo:&#10;EEMTI LICEU DO CEAR츼&#10;EEMTI GOV. ADAUTO BEZERRA&#10;EEM CEL. FILOMENO DE MORAIS" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 text-sm"></textarea>
            
            <button id="search-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md">
                Buscar E-mails
            </button>
        </div>

        <div id="results-area" class="hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Resultados da Busca</h2>

            <button id="copy-emails-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 shadow-md mb-4 disabled:bg-gray-400" disabled>
                游늶 Copiar Todos os E-mails (0 encontrados)
            </button>
            <span id="copy-message" class="text-green-600 text-sm mb-4 hidden block">E-mails copiados para a 치rea de transfer칡ncia!</span>

            <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/2">Escola</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/2">E-mail</th>
                        </tr>
                    </thead>
                    <tbody id="results-body" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>

            <p id="summary-text" class="text-sm text-gray-600 mt-4 font-medium"></p>
        </div>

        <div id="no-emails-alert" class="mt-8 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 hidden rounded-lg" role="alert">
            <p class="font-bold">Aten칞칚o!</p>
            <p>Nenhuma escola ou e-mail v치lido foi encontrado com base na sua lista.</p>
        </div>
    </div>

    <script>
        // Vari치veis de refer칡ncia para elementos HTML
        const schoolNamesInput = document.getElementById('school-names-input');
        const searchBtn = document.getElementById('search-btn');
        const resultsArea = document.getElementById('results-area');
        const resultsBody = document.getElementById('results-body');
        const copyEmailsBtn = document.getElementById('copy-emails-btn');
        const copyMessage = document.getElementById('copy-message');
        const summaryText = document.getElementById('summary-text');
        const noEmailsAlert = document.getElementById('no-emails-alert');

        let foundEmails = []; // Armazena apenas os e-mails v치lidos para a fun칞칚o de c칩pia

        /**
         * L칩gica principal de busca e exibi칞칚o.
         */
        searchBtn.addEventListener('click', () => {
            const rawInput = schoolNamesInput.value;
            // 1. Limpa e normaliza os nomes das escolas
            const inputNames = rawInput
                .split(/[\n,;]+/) // Divide por nova linha, v칤rgula ou ponto e v칤rgula
                .map(name => name.trim().toUpperCase()) // Remove espa칞os e coloca em mai칰sculo para compara칞칚o
                .filter(name => name.length > 0); // Remove linhas vazias

            if (inputNames.length === 0) {
                alert('Por favor, insira pelo menos um nome de escola.');
                resultsArea.classList.add('hidden');
                return;
            }

            // Vari치veis de controle
            let htmlContent = '';
            let validEmails = [];
            let totalFound = 0;

            // 2. Busca os e-mails no banco de dados (escolas_data)
            inputNames.forEach(inputName => {
                // Tenta encontrar a escola no array global escolas_data
                const escola = escolas_data.find(e => 
                    e.nome && e.nome.toUpperCase().trim() === inputName
                );

                if (escola) {
                    totalFound++;
                    const email = escola.email && escola.email.trim() ? escola.email.trim() : 'E-mail n칚o registrado';
                    const emailClass = email === 'E-mail n칚o registrado' ? 'text-red-500 font-medium' : 'text-blue-600 font-semibold';
                    
                    // Se o e-mail for v치lido, armazena para c칩pia
                    if (email !== 'E-mail n칚o registrado') {
                        validEmails.push(email);
                    }

                    // Gera o HTML da linha do relat칩rio
                    htmlContent += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">${escola.nome}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm ${emailClass}">${email}</td>
                        </tr>
                    `;
                } else {
                     // Adiciona uma linha para escolas n칚o encontradas (opcional, mas 칰til para feedback)
                     htmlContent += `
                        <tr class="bg-yellow-50 hover:bg-yellow-100">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">${inputName}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-yellow-700">Escola n칚o encontrada no banco de dados.</td>
                        </tr>
                    `;
                }
            });

            // 3. Atualiza a interface
            resultsBody.innerHTML = htmlContent;
            resultsArea.classList.remove('hidden');
            noEmailsAlert.classList.add('hidden');
            copyMessage.classList.add('hidden');

            // 4. L칩gica do bot칚o de c칩pia
            foundEmails = validEmails;
            if (foundEmails.length > 0) {
                copyEmailsBtn.disabled = false;
                copyEmailsBtn.textContent = `游늶 Copiar Todos os E-mails (${foundEmails.length} encontrados)`;
                summaryText.textContent = `Encontradas ${totalFound} escolas na sua lista. ${foundEmails.length} e-mails v치lidos prontos para c칩pia.`;
            } else {
                copyEmailsBtn.disabled = true;
                copyEmailsBtn.textContent = `游늶 Copiar Todos os E-mails (0 encontrados)`;
                summaryText.textContent = `Encontradas ${totalFound} escolas na sua lista. Nenhum e-mail v치lido encontrado para c칩pia.`;
                if (totalFound === 0) {
                    noEmailsAlert.classList.remove('hidden');
                }
            }
        });

        /**
         * L칩gica de c칩pia para a 치rea de transfer칡ncia.
         */
        copyEmailsBtn.addEventListener('click', () => {
            if (foundEmails.length === 0) return;

            // Junta todos os e-mails com ponto e v칤rgula, que 칠 o separador padr칚o de muitos clientes de e-mail (Outlook, Gmail).
            const emailsToCopy = foundEmails.join('; ');

            if (navigator.clipboard) {
                navigator.clipboard.writeText(emailsToCopy).then(() => {
                    copyMessage.classList.remove('hidden');
                    setTimeout(() => {
                        copyMessage.classList.add('hidden');
                    }, 3000);
                }).catch(err => {
                    alert('Erro ao copiar os e-mails. Tente novamente.');
                    console.error('Erro ao copiar:', err);
                });
            } else {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = emailsToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);

                copyMessage.classList.remove('hidden');
                setTimeout(() => {
                    copyMessage.classList.add('hidden');
                }, 3000);
            }
        });
    </script>
</body>
</html>
