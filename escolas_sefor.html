<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEFOP - Gerador de Contatos de Escolas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
    </style>
</head>
<body class="min-h-screen flex items-start justify-center p-4 sm:p-8">

    <script src="escolas_data.js"></script>

    <div class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-6 sm:p-8 mt-10">

        <h1 class="text-3xl font-bold text-gray-800 mb-2">üì© Contatos das Escolas</h1>
        <p class="text-gray-500 mb-8">Selecione o SEFOR e a Escola para visualizar as informa√ß√µes de contato.</p>

        <div class="space-y-6">

            <div>
                <label for="sefor-select" class="block text-sm font-medium text-gray-700 mb-2">1. Selecione a Regional (SEFOR)</label>
                <select id="sefor-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    <option value="" disabled selected>Escolha o SEFOR</option>
                    <option value="SEFOR 1">SEFOR 1</option>
                    <option value="SEFOR 2">SEFOR 2</option>
                    <option value="SEFOR 3">SEFOR 3</option>
                </select>
            </div>

            <div>
                <label for="escola-select" class="block text-sm font-medium text-gray-700 mb-2">2. Selecione a Escola</label>
                <select id="escola-select" disabled class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    <option value="" disabled selected>Selecione um SEFOR primeiro</option>
                </select>
            </div>
            
        </div>

        <div id="contato-info" class="mt-8 p-6 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg shadow-md hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Informa√ß√µes de Contato</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                
                <div class="flex items-center space-x-3">
                    <span class="font-medium text-gray-600">Escola:</span>
                    <p id="info-nome" class="font-bold text-gray-800"></p>
                </div>
                
                <div class="flex items-center space-x-3">
                    <span class="font-medium text-gray-600">Regional:</span>
                    <p id="info-sefor" class="font-bold text-blue-600"></p>
                </div>

                <div class="flex items-center space-x-3">
                    <span class="font-medium text-gray-600">E-mail:</span>
                    <p id="info-email" class="text-red-600 font-semibold truncate"></p>
                </div>
                
                <div class="flex items-center space-x-3">
                    <span class="font-medium text-gray-600">Telefone:</span>
                    <p id="info-telefone" class="text-gray-800"></p>
                </div>

                <div class="flex items-center space-x-3">
                    <span class="font-medium text-gray-600">Diretor(a):</span>
                    <p id="info-diretor" class="text-gray-800"></p>
                </div>

                <div class="flex items-center space-x-3">
                    <span class="font-medium text-gray-600">Celular:</span>
                    <p id="info-celular" class="text-gray-800"></p>
                </div>
            </div>
            
            <button id="copy-email-btn" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 shadow-md disabled:bg-gray-400" disabled>
                Copiar Endere√ßo de E-mail
            </button>
            <span id="copy-message" class="text-green-600 text-sm mt-2 hidden block">E-mail copiado!</span>
        </div>

        <div id="email-vazio-alerta" class="mt-8 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 hidden rounded-lg" role="alert">
            <p class="font-bold">Aten√ß√£o!</p>
            <p>Esta escola n√£o tem um e-mail registrado no nosso banco de dados.</p>
        </div>
    </div>

    <script>
        // O array 'escolas_data' √© carregado do arquivo escolas_data.js
        const seforSelect = document.getElementById('sefor-select');
        const escolaSelect = document.getElementById('escola-select');
        const contatoInfoDiv = document.getElementById('contato-info');
        const emailVazioAlerta = document.getElementById('email-vazio-alerta');
        const copyEmailBtn = document.getElementById('copy-email-btn');
        const copyMessage = document.getElementById('copy-message');

        let escolasFiltradas = [];

        // 1. Fun√ß√£o para carregar as escolas ap√≥s a sele√ß√£o do SEFOR
        seforSelect.addEventListener('change', (event) => {
            const seforSelecionado = event.target.value;
            
            // Filtra o array global 'escolas_data'
            escolasFiltradas = escolas_data.filter(escola => escola.sefor === seforSelecionado);
            
            // Limpa o select de escolas e o resultado
            escolaSelect.innerHTML = '<option value="" disabled selected>Selecione a Escola</option>';
            contatoInfoDiv.classList.add('hidden');
            emailVazioAlerta.classList.add('hidden');
            copyMessage.classList.add('hidden');

            if (escolasFiltradas.length > 0) {
                // Habilita o select e preenche as op√ß√µes
                escolaSelect.disabled = false;
                escolaSelect.classList.remove('bg-gray-100');
                
                escolasFiltradas.sort((a, b) => a.nome.localeCompare(b.nome)); // Ordena por nome
                
                escolasFiltradas.forEach(escola => {
                    const option = document.createElement('option');
                    option.value = escola.nome;
                    option.textContent = escola.nome;
                    escolaSelect.appendChild(option);
                });
            } else {
                escolaSelect.disabled = true;
                escolaSelect.classList.add('bg-gray-100');
            }
        });

        // 2. Fun√ß√£o para exibir os dados de contato da escola selecionada
        escolaSelect.addEventListener('change', (event) => {
            const nomeEscolaSelecionada = event.target.value;
            const escola = escolasFiltradas.find(e => e.nome === nomeEscolaSelecionada);

            if (escola) {
                // Atualiza a √°rea de informa√ß√µes
                document.getElementById('info-nome').textContent = escola.nome || 'N/A';
                document.getElementById('info-sefor').textContent = escola.sefor || 'N/A';
                document.getElementById('info-email').textContent = escola.email || 'E-mail n√£o registrado';
                document.getElementById('info-telefone').textContent = escola.telefone || 'N/A';
                document.getElementById('info-diretor').textContent = escola.diretor || 'N/A';
                document.getElementById('info-celular').textContent = escola.celular || 'N/A';
                
                contatoInfoDiv.classList.remove('hidden');
                emailVazioAlerta.classList.add('hidden');
                copyMessage.classList.add('hidden');

                // L√≥gica do bot√£o de copiar
                if (escola.email && escola.email !== 'E-mail n√£o registrado' && escola.email.trim() !== "") {
                    copyEmailBtn.disabled = false;
                    copyEmailBtn.classList.remove('disabled:bg-gray-400');
                } else {
                    copyEmailBtn.disabled = true;
                    copyEmailBtn.classList.add('disabled:bg-gray-400');
                    emailVazioAlerta.classList.remove('hidden');
                }
            } else {
                contatoInfoDiv.classList.add('hidden');
            }
        });

        // 3. Funcionalidade para copiar o email
        copyEmailBtn.addEventListener('click', () => {
            const email = document.getElementById('info-email').textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(email).then(() => {
                    copyMessage.classList.remove('hidden');
                    setTimeout(() => {
                        copyMessage.classList.add('hidden');
                    }, 2000);
                }).catch(err => {
                    console.error('Erro ao copiar o texto: ', err);
                    alert('Erro ao copiar o e-mail. Tente copiar manualmente.');
                });
            } else {
                // Fallback para navegadores sem suporte a navigator.clipboard
                const textarea = document.createElement('textarea');
                textarea.value = email;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);

                copyMessage.classList.remove('hidden');
                setTimeout(() => {
                    copyMessage.classList.add('hidden');
                }, 2000);
            }
        });

    </script>
</body>
</html>
